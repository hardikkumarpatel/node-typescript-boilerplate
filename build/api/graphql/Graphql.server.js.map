{"version":3,"file":"Graphql.server.js","names":["_expressBasicAuth","_interopRequireDefault","require","_server","_config","_drainHttpServer","_express","_schema","_resolvers","e","__esModule","default","asyncGeneratorStep","n","t","r","o","a","c","i","u","value","done","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","GraphQLServer","constructor","app","initialize","HttpServer","_this","graphQLServer","ApolloServer","typeDefs","GraphQLSchemaDef","get","resolvers","GraphQLSchemaResolvers","nodeEnv","Config","IConfigKey","NODE_ENV","includeStacktraceInErrorResponses","plugins","ApolloServerPluginDrainHttpServer","httpServer","start","set","global","GraphQL","use","expressBasicAuth","users","root","challenge","expressMiddleware","context","_context","_ref","req","token","headers","_x","concat","PORT","_default","exports"],"sources":["../../../src/api/graphql/Graphql.server.ts"],"sourcesContent":["import express from \"express\";\nimport HTTP from \"node:http\";\nimport expressBasicAuth from \"express-basic-auth\";\nimport { ApolloServer } from \"@apollo/server\";\nimport { Config, IConfigKey } from \"@/config\";\nimport { ApolloServerPluginDrainHttpServer } from \"@apollo/server/plugin/drainHttpServer\";\nimport { expressMiddleware } from \"@apollo/server/express4\";\nimport GraphQLSchemaDef from \"@/api/graphql/schema\";\nimport GraphQLSchemaResolvers from \"@/api/graphql/resolvers\";\n\nclass GraphQLServer {\n  private app: express.Application;\n  constructor(app: express.Application) {\n    this.app = app;\n  }\n\n  public async initialize(HttpServer: HTTP.Server): Promise<string> {\n    const graphQLServer = new ApolloServer({\n      typeDefs: new GraphQLSchemaDef().get(),\n      resolvers: new GraphQLSchemaResolvers().get(),\n      nodeEnv: Config.get<string>(IConfigKey.NODE_ENV),\n      includeStacktraceInErrorResponses: true,\n      plugins: [ApolloServerPluginDrainHttpServer({ httpServer: HttpServer })]\n    });\n    await graphQLServer.start();\n    this.app.set(\"GraphQL\", graphQLServer);\n    (global as any).GraphQL = graphQLServer;\n    this.app.use(\n      \"/graphql\",\n      expressBasicAuth({\n        users: {\n          root: \"deamon\"\n        },\n        challenge: true\n      })\n    );\n    this.app.use(\n      \"/graphql\",\n      expressMiddleware(graphQLServer, {\n        context: async ({ req }) => ({ token: req.headers.token })\n      })\n    );\n    return `GraphQL server is running at http://localhost:${Config.get<number>(IConfigKey.PORT)}/graphql ðŸš€`;\n  }\n}\n\nexport default GraphQLServer;\n"],"mappings":"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","ignoreList":[]}