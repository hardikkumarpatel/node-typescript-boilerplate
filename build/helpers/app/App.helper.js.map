{"version":3,"file":"App.helper.js","names":["_httpStatusCodes","_interopRequireWildcard","require","_","_config","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","asyncGeneratorStep","o","c","value","done","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","_defineProperty","_toPropertyKey","enumerable","configurable","writable","_toPrimitive","Symbol","toPrimitive","TypeError","String","Number","AppHelper","serverErrorListening","error","syscall","code","Log","info","process","exit","concat","Config","IConfigKey","PORT","listening","server","address","port","signalListening","app","http","on","close","SIGINTError","Error","_GraphQL","_IO","global","GraphQL","stop","IO","kill","pid","UncaughtError","_GraphQL2","_IO2","UncaughtReason","req","res","platform","status","StatusCodes","OK","json","ApiResponseHelper","mode","NODE_ENV","platfrom","console","log","method","baseUrl","originalUrl","url","ApiErrorResponseHelper","NOT_FOUND","getReasonPhrase","_default","exports"],"sources":["../../../src/helpers/app/App.helper.ts"],"sourcesContent":["import express, { Request, Response } from \"express\";\nimport StatusCodes, { getReasonPhrase } from \"http-status-codes\";\nimport HTTP from \"node:http\";\nimport { AddressInfo } from \"node:net\";\nimport { ApiErrorResponseHelper, ApiResponseHelper, Log } from \"@/helpers\";\nimport { Config, IConfigKey } from \"@/config\";\nimport { ApolloServer } from \"@apollo/server\";\nimport { Server } from \"socket.io\";\n\nclass AppHelper {\n  public static async serverErrorListening(error: NodeJS.ErrnoException): Promise<void> {\n    if (error.syscall !== \"listen\") {\n      throw error;\n    }\n\n    switch (error.code) {\n      case \"EACCES\":\n        Log.info(\"Requires privileges\");\n        return process.exit(1);\n\n      case \"EADDRINUSE\":\n        Log.error(`${Config.get<number>(IConfigKey.PORT)} is already in use`);\n        return process.exit(1);\n\n      default:\n        throw error;\n    }\n  }\n\n  public static async listening(server: HTTP.Server): Promise<void> {\n    const address: AddressInfo = <AddressInfo>server.address();\n    Log.info(`Express engine is running on ${address.port} üöÄ`);\n  }\n\n  public static signalListening(app: express.Application): void {\n    const http: HTTP.Server = app.get(\"HttpServer\");\n    process\n      .on(\"SIGINT\", async () => {\n        try {\n          http.close();\n        } catch (SIGINTError: unknown) {\n          if (SIGINTError instanceof Error) {\n            Log.error(`Error occurred during shutdown server`, SIGINTError);\n          }\n        } finally {\n          ((global as any).GraphQL as ApolloServer)?.stop();\n          ((global as any).IO as Server)?.close();\n          Log.http(`Express engine and all running instance are shutdown successfully üå±`);\n          process.exit(1);\n        }\n      })\n      .on(\"SIGHUP\", () => {\n        process.kill(process.pid, \"SIGTERM\");\n      })\n      .on(\"uncaughtException\", (UncaughtError: Error) => {\n        Log.error(`Uncaught Exception thrown`, UncaughtError);\n        http.close();\n        ((global as any).GraphQL as ApolloServer)?.stop();\n        ((global as any).IO as Server)?.close();\n        process.exit(1);\n      })\n      .on(\"unhandledRejection\", (UncaughtReason: Error) => {\n        Log.error(`Unhandled Rejection thrown`, UncaughtReason);\n        process.exit(1);\n      });\n  }\n\n  public static useAppHealthRoute = (req: Request, res: Response): Response => {\n    const { platform, pid } = process;\n    return res.status(StatusCodes.OK).json(\n      new ApiResponseHelper<Record<string, unknown>>(\n        StatusCodes.OK,\n        \"Welcome to backend! Made in Node with ‚ù§Ô∏è\",\n        {\n          mode: Config.get<string>(IConfigKey.NODE_ENV),\n          platfrom: platform,\n          pid: pid\n        }\n      )\n    );\n  };\n\n  public static useAppNotFoundRoute = (req: Request): void => {\n    console.log(\"RR\", req.method);\n    console.log(\"RR\", req.baseUrl);\n    console.log(\"RR\", req.originalUrl);\n    console.log(\"RR\", req.url);\n    throw new ApiErrorResponseHelper<string>(\n      StatusCodes.NOT_FOUND,\n      \"Request resource not found\",\n      getReasonPhrase(StatusCodes.NOT_FOUND)\n    );\n  };\n}\nexport default AppHelper;\n"],"mappings":"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","ignoreList":[]}